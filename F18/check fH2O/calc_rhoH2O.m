% calc_rhoH2O.m
%
% based on Pitzer and Sterner [1994]
% see also Zatsunen, vol.5, p.39-41
%
% fH2O in MPa
% P in GPa
% T in K
function [rho,rhor,PrhoRT] = calc_rhoH2O(P,T)

cij0= [0                 0               0.24657688e6 ; ...
       0                 0               0.58638965e0 ; ...
       0                 0              -0.62783840e1 ; ...
       0                 0               0            ; ...
       0                 0               0.56654978e4 ; ...
       0                 0               0            ; ...
       0.38878656e13    -0.13494878e9    0.30916564e6 ; ...
       0                 0              -0.65537898e5 ; ...
      -0.14182435e14     0.18165390e9   -0.19769068e6 ; ...
       0                 0               0.92093375e5];
cij1= [0.51359951e2      0               0 ; ...
      -0.28646939e-2     0.31375577e-4   0 ; ...
       0.14791599e-1     0.35779579e-3   0.15432925e-7; ...
      -0.42719875e0     -0.16325155e-4   0 ; ...
      -0.16580167e2      0.76560762e-1   0 ; ...
       0.10917883e0      0               0 ; ...
       0.75591105e1      0               0 ; ...
       0.18810675e3      0               0 ; ...
      -0.23530318e2      0               0 ; ...
       0.12246777e3      0               0 ];
cij = [cij0 cij1];

facT=zeros(6,1);
facT(1) = T^(-4); facT(2) = T^(-2); facT(3) = 1/T; facT(4) = 1;
facT(5) = T; facT(6) = T^2;

c=zeros(10,1);
for i=1:10
  tmp=0;
  for j=1:6
    tmp=tmp+cij(i,j)*facT(j);
  end
  c(i) = tmp;
end

% first determine rho (i.e., volume) from P & T
% rho [mol/cm^3] - with this unit, fH2O will be in MPa
R = 8.314472;
P = P*1e3; % now in MPa

eq2LHS = P/(R*T);
rhoc = 0.017874; % critical density [mol/cc]

%rho=fzero(@(x) calc_PS94_eq2RHS(x,c,eq2LHS),0.05);
rho=fminbnd(@(x) calc_PS94_eq2RHS(x,c,eq2LHS), 0,10*rhoc, ...
	    optimset('TolX', 1e-9));

rhor = rho/rhoc;
PrhoRT = eq2LHS/rho;

